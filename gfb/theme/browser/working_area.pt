<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">

<metal:head fill-slot="top_slot"
tal:define="dummy python:request.set('disable_border',1)" />


  <body>
    <div metal:fill-slot="main"
        i18n:domain="gfb"
        tal:define="dummy view/setup">

            <div id="dashboard-actions"
                 tal:define="controlPanel python:modules['Products.CMFCore.utils'].getToolByName(here, 'portal_controlpanel');
                             groups python:controlPanel.getGroups('member');
                             getIconFor nocall:putils/getIconFor" >
                <ul>
                    <tal:groups condition="groups"
                        define="allowed python:['MemberPassword']">
                        <tal:group repeat="group groups">
                            <tal:configlets repeat="configlet python:controlPanel.enumConfiglets(group=group['id'])">
                                <li tal:condition="python:configlet['id'] in allowed and configlet['visible']">
                                    <a href=""
                                       tal:attributes="href configlet/url">
                                        <img src="" alt="" tal:attributes="src python:getIconFor('controlpanel',configlet['id']);
                                                                           alt configlet/title;"
                                             i18n:attributes="alt"
                                             tal:on-error="string:" />
                                    <tal:configletname tal:content="configlet/title"
                                                       i18n:translate=""></tal:configletname>
                                    </a>
                                </li>
                            </tal:configlets>
                        </tal:group>
                    </tal:groups>
                </ul>
            </div>


        <h1 i18n:translate="label_workingarea">Working Area</h1>

        <p class="discreet"
            i18n:translate="workingarea_intro">
          Here you can add a Provider and manage your Risk Assessment Links.
        </p>

        <fieldset tal:define="provider view/provider;
                        providerReviewState view/providerReviewState;
                        adminOnProvider python:user.allowed(provider, ['Manager']);">

          <legend i18n:translate="box_myprovider">Provider information</legend>

            <div class="ws_address" tal:condition="python:provider is not None"
                tal:define="plone_view context/@@plone;">

                <div class="ws_address_info">
                    <strong tal:content="provider/pretty_title_or_id" /><br/>
                    <a tal:attributes="href provider/getRemoteUrl" tal:content="provider/getRemoteUrl" /><br/>
                    <span tal:replace="provider/getContact_name" /><br/>
                    <span tal:define="br string:&gt;br/>; lines python:br.join(provider.getAddress())" tal:replace="structure " /><br/>
                    <span i18n:translate="contact_phone" i18n:domain="plone" tal:omit-tag="">Phone</span>: <span tal:replace="provider/getPhone" /><br/>
                    <span i18n:translate="contact_fax" i18n:domain="plone" tal:omit-tag="">Fax</span>: <span tal:replace="provider/getFax" /><br/>
                </div>

                <div class="item_actions"  i18n:domain="plone" >
                      <div class="actionbtn">
                          <a class="context" tal:attributes="href provider/absolute_url"
                             i18n:translate="label_view">View</a>
                       </div>
                       <div class="actionbtn" tal:condition="adminOnProvider">
                        <a class="context" tal:attributes="href string:${provider/absolute_url}/edit"
                             i18n:translate="label_edit">Edit</a>
                       </div>
                      <div class="actionbtn" tal:condition="python:adminOnProvider 
                            and providerReviewState=='private'">
                        <a class="context" id="publish_button" tal:attributes="href string:${provider/absolute_url}/content_status_modify?workflow_action=publish"
                            i18n:translate="Publish">Publish</a>
                       </div>
                    <p class="item_actions" tal:condition="python:providerReviewState=='private'">
                        <span i18n:domain="gfb" i18n:translate="label_publish_provider">Please publish 
                        your provider information so that it will be visible to others.</span>
                    </p>
                </div>

            </div>

            <div tal:condition="python: provider is None">
                <div i18n:translate="info_no_provider">There is currently no provider information available.
                Please create a provider to be able to add Assessment Links.</div>
                <br />
                <form action="" tal:attributes="action view/create_provider_url">
                    <input type="hidden" name="type_name" value="Provider" />
                    <input type="submit" class="standalone" value="Create Provider"
                        i18n:attributes="value"/>
                </form>
            </div>

        </fieldset>
        <br />

        <div tal:define="myrals view/myrals;
            home_url view/home_url;
            provider_ok view/provider_ok;">
            <h2 i18n:translate="box_myral">My Links</h2>


            <div tal:condition="not: provider_ok">
                <span i18n:translate="help_complete_provider" tal:omit-tag="">
                    Please complete your Provider information. You need a valid provider record before you can add links.
                </span>
            </div><br />

            <div tal:condition="provider_ok">
                <form action="#" tal:attributes="action string:${home_url}/createObject">
                    <input type="hidden" name="type_name" value="RiskAssessmentLink" />
                    <input type="submit" class="standalone" value="link_add_ral" i18n:attributes="value" />
                </form>
            </div>
            <br />

            <span tal:condition="provider_ok">

                <form>
                <dl id="ras_results">
                  <span tal:repeat="obj myrals" tal:omit-tag="">
                    <span tal:omit-tag=""
                        tal:define="oddrow repeat/obj/odd;
                                    plone_view context/@@plone;
                                    getIcon nocall:plone_view/getIcon;
                                    item_icon python:getIcon(obj);">

                        <dt>
                          <img tal:replace="structure item_icon/html_tag" />&nbsp;<a href="#"
                               class="tile"
                               tal:attributes="href obj/getURL;
                                               title obj/Description"
                               tal:content="obj/pretty_title_or_id">Some Document</a>
                        </dt>
                        <dd>
                            <div class="item_description" tal:content="obj/Description">desc</div>
                            <div class="item_actions" i18n:domain="plone" >
                              <div class="actionbtn">
                                 <a class="context" tal:attributes="href obj/getURL"
                                     i18n:translate="label_view">View</a>
                              </div>
                              <div class="actionbtn">
                                  <a class="context" tal:attributes="href string:${obj/getURL}/edit"
                                     i18n:translate="label_edit">Edit</a>
                              </div>
                              <div class="actionbtn">
                                  <a class="context" tal:attributes="href string:${obj/getURL}/delete_confirmation"
                                     i18n:translate="label_delete">Delete</a>
                              </div>
                              <div class="actionbtn" tal:condition="python:obj.review_state=='private'">
                                 <a class="context" id="publish_button" tal:attributes="href string:${obj/getURL}/content_status_modify?workflow_action=publish"
                                     i18n:translate="Publish">Publish</a>
                              </div>
                            </div>
                            <br clear="all" />
                        </dd>
                    </span>
                  </span>
                </dl>
                </form>

                <div tal:condition="not: myrals"><p class="discreet"
                    i18n:translate="description_no_riskassessmentlinks_in_folder">
                    There are currently no Risk Assessment Links in this folder.
                    </p>
                </div>
            </span>
        </div>


    </div>
  </body>
</html>